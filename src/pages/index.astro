---
import IDELayout from '../layouts/IDELayout.astro';
import InlineQuery from '../components/InlineQuery.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const allProjects = await getCollection('projects');

const recentPosts = allPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const featuredProjects = allProjects
  .filter(p => p.data.featured)
  .slice(0, 3);

const headings = [
  { depth: 1, slug: 'aaron', text: 'Aaron' },
  { depth: 2, slug: 'recent-writing', text: 'Recent Writing' },
  { depth: 2, slug: 'featured-projects', text: 'Featured Projects' },
];
---

<IDELayout title="Home" currentPath="/" headings={headings}>
  <section class="mb-12">
    <h1 id="aaron" class="!mt-0">Aaron Oswald</h1>
    <p class="text-lg text-[var(--color-accent)] mb-4">
      Systems thinker who specializes in data.
    </p>
    <p>
      Based in Washington, D.C.
      </p>
    <p> Currently a <b>Pr. Data Analyst at Capital One</b>. When I'm not
    analyzing data, I write about data systems,
      visualization, and the occasional experiment at the intersection of
      technology and creativity.
    </p>
  </section>

  <div class="my-6">
    <InlineQuery placeholder="* FROM blog" />
  </div>

  {recentPosts.length > 0 && (
    <section class="mb-12">
      <h2 id="recent-writing">Recent Writing</h2>
      <ul class="space-y-3">
        {recentPosts.map((post) => (
          <li class="flex items-baseline gap-3">
            <span class="text-[var(--color-keyword)]">--</span>
            <a href={`/blog/${post.id}`} class="hover:text-[var(--color-accent)]">
              {post.data.title}
            </a>
            <span class="text-sm text-[var(--color-text-muted)]">
              {post.data.date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
            </span>
          </li>
        ))}
      </ul>
      <a href="/blog" class="inline-block mt-4 text-sm text-[var(--color-accent)] hover:underline">
        View all posts &rarr;
      </a>
    </section>
  )}

  {featuredProjects.length > 0 && (
    <section class="mb-12">
      <h2 id="featured-projects">Featured Projects</h2>
      <ul class="space-y-4">
        {featuredProjects.map((project) => (
          <li>
            <a href={`/projects/${project.id}`} class="group block">
              <span class="text-[var(--color-function)]">{project.data.title}</span>
              <p class="text-sm text-[var(--color-text-muted)] mt-1">
                {project.data.description}
              </p>
            </a>
          </li>
        ))}
      </ul>
      <a href="/projects" class="inline-block mt-4 text-sm text-[var(--color-accent)] hover:underline">
        View all projects &rarr;
      </a>
    </section>
  )}
</IDELayout>
